<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kitap Ekle</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
        button { background: #007bff; color: white; cursor: pointer; border: none; }
        #durum { padding: 10px; display: none; margin-top: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h3>üìö Kitap Ekle</h3>
    <input type="text" id="kitapAdi" placeholder="Kitap adƒ± girin...">
    <button onclick="kitapEkle()">Sisteme Kaydet</button>
    <div id="durum"></div>

    <script>
        const TOKEN = "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"; // Buraya ghp_ ile ba≈ülayan kodunu koy
        const USER = "ugurunal45"; // GitHub adƒ±nƒ± yaz
        const REPO = "kitapligim";

        async function kitapEkle() {
            const ad = document.getElementById('kitapAdi').value;
            const durum = document.getElementById('durum');
            if(!ad) return;

            durum.style.display = "block";
            durum.innerText = "ƒ∞≈ülem yapƒ±lƒ±yor...";
            durum.style.background = "#eee";

            try {
                // 1. Google'dan kitap bilgilerini bul
                const gRes = await fetch(`https://www.googleapis.com/books/v1/volumes?q=intitle:${ad}`);
                const gData = await gRes.json();
                if(!gData.items) throw new Error("Kitap bulunamadƒ±.");
                
                const k = gData.items[0].volumeInfo;
                const yeni = { baslik: k.title, yazar: k.authors?.[0] || "Bilinmiyor", yayinevi: k.publisher || "Bilinmiyor" };

                // 2. GitHub'dan mevcut dosyayƒ± al
                const url = `https://api.github.com/repos/${USER}/${REPO}/contents/kitaplar.json`;
                const fRes = await fetch(url, { headers: { Authorization: `token ${TOKEN}` } });
                const fData = await fRes.json();

                // HATA BURADAYDI: Daha g√ºvenli bir y√∂ntemle i√ßeriƒüi alƒ±yoruz
                const eskiIcerik = JSON.parse(decodeURIComponent(escape(window.atob(fData.content))));
                eskiIcerik.push(yeni);

                // 3. GitHub'a yeni listeyi g√∂nder
                const gonderRes = await fetch(url, {
                    method: "PUT",
                    headers: { Authorization: `token ${TOKEN}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Yeni kitap",
                        content: window.btoa(unescape(encodeURIComponent(JSON.stringify(eskiIcerik)))),
                        sha: fData.sha
                    })
                });

                if(gonderRes.ok) {
                    durum.innerText = "‚úÖ Eklendi: " + yeni.baslik;
                    durum.style.background = "#d4edda";
                    document.getElementById('kitapAdi').value = "";
                }
            } catch (e) {
                durum.innerText = "‚ùå Hata: " + e.message;
                durum.style.background = "#f8d7da";
            }
        }
    </script>
</body>
</html>
