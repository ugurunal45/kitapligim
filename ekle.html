<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kitap Ekle</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; text-align: center; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #durum { margin-top: 20px; padding: 10px; border-radius: 5px; display: none; }
    </style>
</head>
<body>
    <h3>üìö Kitap Ekle</h3>
    <input type="text" id="kitapInput" placeholder="Kitap adƒ±nƒ± yazƒ±n...">
    <button onclick="sistemeEkle()">Hemen Ekle</button>
    <div id="durum"></div>

    <script>
        // --- BURALARI DOLDURUN ---
        const TOKEN = "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"; 
        const USER = "ugurunal45"; 
        const REPO = "kitapligim";

        async function sistemeEkle() {
            const ad = document.getElementById('kitapInput').value;
            const durum = document.getElementById('durum');
            if(!ad) return alert("ƒ∞sim yazƒ±n!");

            durum.style.display = "block";
            durum.innerText = "‚è≥ Ekleniyor...";
            durum.style.background = "#eee";

            try {
                // 1. Google'dan kitap bilgilerini √ßek
                const gRes = await fetch(`https://www.googleapis.com/books/v1/volumes?q=intitle:${encodeURIComponent(ad)}`);
                const gData = await gRes.json();
                if(!gData.items) throw new Error("Kitap bulunamadƒ±.");
                
                const k = gData.items[0].volumeInfo;
                const yeniKitap = { 
                    baslik: k.title, 
                    yazar: k.authors ? k.authors[0] : "Bilinmiyor", 
                    yayinevi: k.publisher || "Bilinmiyor" 
                };

                // 2. Dosyayƒ± GitHub'dan √ßek (Hata almamak i√ßin atob kullanmƒ±yoruz)
                const url = `https://api.github.com/repos/${USER}/${REPO}/contents/kitaplar.json`;
                const fRes = await fetch(url, { headers: { Authorization: `token ${TOKEN}` } });
                const fData = await fRes.json();

                // ƒ∞√ßeriƒüi daha g√ºvenli bir y√∂ntemle √ß√∂z√ºyoruz
                const icerikCozulmus = decodeURIComponent(escape(atob(fData.content.replace(/\s/g, ''))));
                const liste = JSON.parse(icerikCozulmus);
                liste.push(yeniKitap);

                // 3. Dosyayƒ± GitHub'a geri g√∂nder
                const yeniIcerik = btoa(unescape(encodeURIComponent(JSON.stringify(liste, null, 2))));
                const gonderRes = await fetch(url, {
                    method: "PUT",
                    headers: { Authorization: `token ${TOKEN}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Kitap eklendi",
                        content: yeniIcerik,
                        sha: fData.sha
                    })
                });

                if(gonderRes.ok) {
                    durum.innerText = "‚úÖ Ba≈üarƒ±yla Eklendi: " + yeniKitap.baslik;
                    durum.style.background = "#d4edda";
                    document.getElementById('kitapInput').value = "";
                }
            } catch (hata) {
                durum.innerText = "‚ùå Hata: " + hata.message;
                durum.style.background = "#f8d7da";
            }
        }
    </script>
</body>
</html>
